<div dir="rtl" class="min-h-screen flex items-center justify-center font-sans bg-gray-50">
  <div
    class="w-[390px] h-[900px] bg-white rounded-[10px] shadow-2xl flex flex-col relative overflow-hidden border border-gray-100"
  >
    @if (AuthMode() === 'Login' || AuthMode() === 'SignUp') {
    <div class="flex p-4 mt-4 shrink-0 z-10 bg-white">
      <div class="flex w-full p-1 bg-gray-100 rounded-xl">
        <button
          type="button"
          (click)="switchTo('SignUp')"
          class="w-1/2 py-3 text-sm font-bold rounded-lg transition-all duration-300 ease-in-out"
          [class]="
            !isInLoginMode()
              ? 'bg-white text-blue-700 shadow-sm'
              : 'text-gray-500 hover:text-gray-700'
          "
        >
          ثبت نام
        </button>
        <button
          type="button"
          (click)="switchTo('Login')"
          class="w-1/2 py-3 text-sm font-bold rounded-lg transition-all duration-300 ease-in-out"
          [class]="
            isInLoginMode()
              ? 'bg-white text-blue-700 shadow-sm'
              : 'text-gray-500 hover:text-gray-700'
          "
        >
          ورود به حساب
        </button>
      </div>
    </div>
    }

    <div class="flex-grow overflow-y-auto flex flex-col w-full px-6 pb-8 relative custom-scrollbar">
      @if (isInLoginMode()) {
      <div class="animate-fade-in-up flex-grow flex flex-col justify-start mt-20">
        <h2 class="text-2xl font-bold text-center text-gray-800 mb-8">خوش آمدید!</h2>
        <app-login-form
          (loginSubmit)="handleLoginSubmit($event)"
          (ForgotPassClick)="switchTo('ForgotPass-PhoneCodeEntry')"
          [shouldShowCaptcha]="shouldShowcaptcha()"
        >
        </app-login-form>
      </div>
      } @if (isInPhoneEntryMode()) {
      <div class="animate-fade-in-up flex-grow flex flex-col justify-start mt-20">
        <div class="mb-6 text-center">
          <div
            class="w-14 h-14 bg-blue-50 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-3"
          >
            @if(AuthMode() === 'SignUp') {
            <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"
              ></path>
            </svg>
            } @else {
            <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"
              ></path>
            </svg>
            }
          </div>
          <h2 class="text-xl font-bold text-gray-800">
            {{ pageTitle() }}
          </h2>
        </div>

        <form [formGroup]="phoneForm" class="space-y-4">
          <app-text-field
            formControlName="phoneNumber"
            label="شماره تلفن"
            backgroundColor="#f9fafb"
            type="phonenumber"
            placeholder="مثلا 09123456789"
            [showValidationUI]="true"
            [unmetRules]="phoneUnmet()"
            [success]="phoneUnmet().length === 0"
          >
          </app-text-field>

          @if (!isCodeSent()) {
          <div class="flex gap-3 justify-between">
            <div class="w-2/3">
              <app-text-field
                formControlName="captcha"
                label="کد امنیتی"
                backgroundColor="#f9fafb"
                placeholder="کد امنیتی"
                type="text"
                [showValidationUI]="true"
                [success]="captchaInput() === 8273"
              >
              </app-text-field>
            </div>
            <div
              class="w-1/3 h-[48px] bg-gray-100 rounded-lg border border-gray-200 flex items-center justify-center relative overflow-hidden select-none"
            >
              <div
                class="absolute inset-0 opacity-20 pointer-events-none"
                style="
                  background-image: repeating-linear-gradient(
                    45deg,
                    transparent,
                    transparent 5px,
                    #000 5px,
                    #000 6px
                  );
                "
              ></div>
              <span
                class="font-mono text-xl font-bold tracking-widest text-gray-600 rotate-3 inline-block"
                >8372</span
              >
            </div>
          </div>
          <button
            type="button"
            (click)="requestVerificationCode()"
            [disabled]="phoneForm.invalid || phoneUnmet().length > 0 || isLoading()"
            class="w-full py-3 px-4 mt-2 bg-blue-600 text-white font-bold rounded-xl hover:bg-blue-700 transition-all duration-200 disabled:bg-gray-300 disabled:cursor-not-allowed shadow-md flex justify-center items-center"
          >
            @if(isLoading()) {
            <div
              class="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"
            ></div>
            } @else { دریافت کد تایید }
          </button>
          }
        </form>

        @if (isCodeSent()) {
        <div class="mt-6 pt-6 border-t border-gray-100 animate-fade-in-up">
          <p class="text-sm text-center text-gray-600 mb-4">
            کد ارسال شده به شماره {{ PhoneNumber() }} را وارد کنید
          </p>

          <app-verification-code
            [boxNumber]="6"
            [maxLength]="1"
            (verificationComplete)="onCodeChange($event)"
            [verificationCode]="verificationCodeSent()"
          >
          </app-verification-code>

          <div class="flex justify-between items-center mt-6 px-1">
            <span class="text-sm font-medium text-gray-600 flex items-center gap-1">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                ></path>
              </svg>
              {{ formattedTime() }}
            </span>
            <button
              type="button"
              (click)="resendCode()"
              [disabled]="!isTimeUp()"
              class="text-sm font-bold transition-colors"
              [class]="
                isTimeUp()
                  ? 'text-blue-600 hover:text-blue-700 cursor-pointer'
                  : 'text-gray-400 cursor-not-allowed'
              "
            >
              ارسال دوباره
            </button>
          </div>

          <button
            type="button"
            (click)="submitVerificationCode()"
            [disabled]="isTimeUp()"
            class="py-3 px-4 mt-6 text-white font-bold rounded-xl shadow-md transition-all w-full"
            [class]="
              isTimeUp() ? 'bg-gray-300 cursor-not-allowed ' : 'bg-blue-600 hover:bg-blue-700 '
            "
          >
            ثبت و ادامه
          </button>
        </div>
        } @if (AuthMode() === 'SignUp') {
        <a class="text-blue-500 my-7 text-md cursor-pointer text-center" (click)="switchTo('Login')"
          >قبلا عضو شدید؟ وارد شوید</a
        >
        } @if (AuthMode()==='SignUp') {
        <div class="text-gray-700 flex gap-2 items-center justify-center">
          ارتباط با ما : 02182801803

          <!--Telegram-->
          <a href="https://t.me/malitorir" target="_blank">
            <span class="[&>svg]:h-7 [&>svg]:w-7 [&>svg]:fill-[#0088cc]">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512">
                <path
                  d="M248 8C111 8 0 119 0 256S111 504 248 504 496 393 496 256 385 8 248 8zM363 176.7c-3.7 39.2-19.9 134.4-28.1 178.3-3.5 18.6-10.3 24.8-16.9 25.4-14.4 1.3-25.3-9.5-39.3-18.7-21.8-14.3-34.2-23.2-55.3-37.2-24.5-16.1-8.6-25 5.3-39.5 3.7-3.8 67.1-61.5 68.3-66.7 .2-.7 .3-3.1-1.2-4.4s-3.6-.8-5.1-.5q-3.3 .7-104.6 69.1-14.8 10.2-26.9 9.9c-8.9-.2-25.9-5-38.6-9.1-15.5-5-27.9-7.7-26.8-16.3q.8-6.7 18.5-13.7 108.4-47.2 144.6-62.3c68.9-28.6 83.2-33.6 92.5-33.8 2.1 0 6.6 .5 9.6 2.9a10.5 10.5 0 0 1 3.5 6.7A43.8 43.8 0 0 1 363 176.7z"
                />
              </svg>
            </span>
          </a>
          <a href="https://malitor.ir" target="_blank">
            <span class="[&>svg]:h-7 [&>svg]:w-7 [&>svg]:fill-[#128c7e]">
              <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 448 512">
                <path
                  d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5 0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8-3.7 5.6-14.3 18-17.6 21.8-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7 .9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2-3.7 0-9.7 1.4-14.8 6.9-5.1 5.6-19.4 19-19.4 46.3 0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z"
                />
              </svg>
            </span>
          </a>
        </div>
        }
      </div>
      } @if (isInUserProfileMode()) {
      <div class="animate-fade-in-up pt-4 mt-8">
        <h2 class="text-2xl font-bold text-center text-gray-800 mb-6">تکمیل اطلاعات کاربری</h2>
        <app-sign-up-form (formSubmit)="handleFinalSignUp($event)"></app-sign-up-form>
      </div>
      } @if (isInPassResetMode()) {
      <div class="animate-fade-in-up pt-4 mt-20">
        <h2 class="text-2xl font-bold text-center text-gray-800 mb-6">تغییر رمز عبور</h2>

        <form [formGroup]="resetPassForm" class="flex flex-col gap-4">
          <app-text-field
            formControlName="newPassword"
            label="رمز عبور جدید"
            placeholder="رمز عبور جدید خود را وارد کنید"
            type="password"
            backgroundColor="#f9fafb"
            [isStatic]="false"
            [showValidationUI]="true"
            [passwordScore]="passwordScore()"
            [passwordColor]="passwordColor()"
            [passwordPercentage]="passwordPercentage()"
            [unmetRules]="passwordUnmet()"
            [success]="
              passwordUnmet().length === 0 && (resetPassForm.get('newPassword')?.dirty ?? false)
            "
          >
          </app-text-field>

          <app-text-field
            formControlName="confirmPassword"
            label="تکرار رمز عبور"
            type="password"
            placeholder="********"
            [showValidationUI]="false"
            backgroundColor="#f9fafb"
          ></app-text-field>

          <button
            (click)="handlePasswordReset()"
            [disabled]="resetPassForm.invalid || passwordUnmet().length > 0 || isLoading()"
            class="w-full py-3 px-4 mt-4 bg-blue-600 text-white font-bold rounded-xl hover:bg-blue-700 shadow-md disabled:bg-gray-300 disabled:cursor-not-allowed"
          >
            @if(isLoading()) {
            <div
              class="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin mx-auto"
            ></div>
            } @else { تغییر رمز }
          </button>
        </form>
      </div>
      }
    </div>
  </div>
</div>
